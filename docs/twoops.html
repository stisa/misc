<html>
<head>
    <title>NimWasm - Two operations</title>
</head>
<body>
    <div>
        <h2>Adding and subtracting with WebAssembly</h2>
        <p>Write two numbers in the boxes below and then click on the `=` to show the result calculated from WebAssembly.</p>
        <input id="arg1" style="text-align: right;" size="7" />
        <span></span>
        <input id="arg2" style="text-align: right;" size="7" />
        <input type="submit" value="=" onclick="showRes()"/>
        <span id="result"></span>
        <span id="result2"></span>
        <code><pre>
import ../src/nimwasm

var mymod = module()

var ft = fnType(WasmType.Func,ValueType.I32, ValueType.I32,ValueType.I32)
mymod.types = typeSec(ft)

# Signature is the same for add and sub, so we just repeat the signature index
mymod.functions = fnSec(0,0) 

var 
  ee = exportEntry("add",ExternalKind.Function,0)
  ee2 = exportEntry("sub",ExternalKind.Function,1)
mymod.exports = exportSec(ee,ee2)

# load 0, load 1, add
var fb = fnBody("\32\0\32\1\106") # add
var fb2 = fnBody("\32\0\32\1\107") # sub
mymod.codes = codeSec(fb,fb2)

writefile("twoops.wasm",encode(mymod))
        </pre></code>
        <script>
            var wasmexports;
            fetch('twoops.wasm').then(response =>
                response.arrayBuffer()
                ).then(bytes =>
                WebAssembly.instantiate(bytes)
                ).then(results => {
                    wasmexports = results.instance.exports
            });
            function showRes(){
                var a = document.getElementById("arg1").value
                var b = document.getElementById("arg2").value
                document.getElementById("result").innerText = wasmexports.add(a,b)
                document.getElementById("result2").innerText = wasmexports.sub(a,b)
            }
        </script>
    </div>
</body>
</html>